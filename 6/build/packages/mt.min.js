var mt={};mt.Application=function(a){mt.Application._super.call(this);this.data=a};JW.extend(mt.Application,JW.UI.Component,{renderProfileBox:function(){return new mt.ProfileBox(this.data)},renderTweets:function(){return new mt.TweetFeed(this.data)},renderComponent:function(){this._super();$("html").addClass("mt-html");$("body").addClass("mt-body")}});JW.UI.template(mt.Application,{main:'<div jwclass="mt-application"><div jwid="wrap"><div jwid="profile-box"></div><div jwid="tweets"></div><div class="clear"></div></div></div>'});mt.Data=function(){mt.Data._super.call(this);this.profile=null;this.tweets=new JW.ObservableArray()};JW.extend(mt.Data,JW.Class,{destroy:function(){this.tweets.destroy();this._super()}});mt.Data.createByJson=function(a){var b=new mt.Data();b.profile=mt.data.Profile.createByJson(a.profile);b.tweets.addAll(JW.Array.map(a.tweets,mt.data.Tweet.createByJson));return b};mt.data={};mt.data.Profile=function(a){mt.data.Profile._super.call(this);this.fullName=a.fullName;this.shortName=a.shortName;this.avatarUrl32=a.avatarUrl32;this.avatarUrl48=a.avatarUrl48;this.tweets=a.tweets;this.following=a.following;this.followers=a.followers};JW.extend(mt.data.Profile,JW.Class,{});mt.data.Profile.createByJson=function(a){return new mt.data.Profile(a)};mt.data.Tweet=function(a){mt.data.Tweet._super.call(this);this.fullName=a.fullName;this.shortName=a.shortName;this.avatarUrl48=a.avatarUrl48;this.contentHtml=a.contentHtml;this.time=a.time;this.like=a.like;this.retweet=a.retweet;this.likeChangeEvent=new JW.Event();this.retweetChangeEvent=new JW.Event()};JW.extend(mt.data.Tweet,JW.Class,{destroy:function(){this.retweetChangeEvent.destroy();this.likeChangeEvent.destroy();this._super()},setLike:function(a){if(this.like===a){return}this.like=a;this.likeChangeEvent.trigger(new JW.ValueEventParams(this,a))},setRetweet:function(a){if(this.retweet===a){return}this.retweet=a;this.retweetChangeEvent.trigger(new JW.ValueEventParams(this,a))}});mt.data.Tweet.createByJson=function(a){return new mt.data.Tweet(JW.apply({},a,{time:new Date().getTime()-a.timeAgo}))};mt.ProfileBox=function(a){this._onComposeSubmit=JW.inScope(this._onComposeSubmit,this);mt.ProfileBox._super.call(this);this.data=a};JW.extend(mt.ProfileBox,JW.UI.Component,{renderTop:function(a){a.attr("href","https://twitter.com/"+this.data.profile.shortName)},renderAvatar:function(a){a.css("background-image","url("+this.data.profile.avatarUrl32+")")},renderFullName:function(a){a.text(this.data.profile.fullName)},renderTweets:function(a){a.attr("href","https://twitter.com/"+this.data.profile.shortName)},renderTweetsValue:function(a){a.text(this.data.profile.tweets)},renderFollowingValue:function(a){a.text(this.data.profile.following)},renderFollowersValue:function(a){a.text(this.data.profile.followers)},renderComposeForm:function(a){a.submit(this._onComposeSubmit)},_onComposeSubmit:function(a){a.preventDefault();var b=JW.String.trim(this.getElement("compose-input").val());if(!b){return}this.data.tweets.add(new mt.data.Tweet({fullName:this.data.profile.fullName,shortName:this.data.profile.shortName,avatarUrl48:this.data.profile.avatarUrl48,contentHtml:b,time:new Date().getTime(),like:false,retweet:false}),0);this.getElement("compose-input").val("")}});JW.UI.template(mt.ProfileBox,{main:'<div jwclass="mt-profile-box"><a jwid="top" class="blocklink" href="#" target="_blank"><div jwid="avatar"></div><div jwid="full-name"></div><div jwid="show-profile">Show my profile</div><div class="clear"></div></a><div jwid="middle"><a jwid="tweets" class="blocklink mt-profile-box-count" href="#" target="_blank"><div jwid="tweets-value" class="mt-profile-box-count-value"></div><div class="mt-profile-box-count-label">TWEETS</div></a><a jwid="following" class="blocklink mt-profile-box-count mt-profile-box-count-border" href="https://twitter.com/following" target="_blank"><div jwid="following-value" class="mt-profile-box-count-value"></div><div class="mt-profile-box-count-label">FOLLOWING</div></a><a jwid="followers" class="blocklink mt-profile-box-count mt-profile-box-count-border" href="https://twitter.com/followers" target="_blank"><div jwid="followers-value" class="mt-profile-box-count-value"></div><div class="mt-profile-box-count-label">FOLLOWERS</div></a><div class="clear"></div></div><div jwid="bottom"><form jwid="compose-form"><div jwid="compose-fields"><textarea jwid="compose-input" type="text" placeholder="Compose tweet..."></textarea></div><div jwid="compose-buttons"><input jwid="compose-submit" type="submit" value="Tweet"></div></form></div></div>'});mt.TweetFeed=function(a){mt.TweetFeed._super.call(this);this.data=a;this._mapper=null};JW.extend(mt.TweetFeed,JW.UI.Component,{renderTweets:function(){this._mapper=this.data.tweets.createMapper({createItem:function(a){return new mt.TweetView(this.data,a)},destroyItem:JW.destroy,scope:this});return this._mapper.target},destroyComponent:function(){this._mapper.destroy();this._super()}});JW.UI.template(mt.TweetFeed,{main:'<div jwclass="mt-tweet-feed"><div jwid="header">Tweets</div><div jwid="tweets"></div><div jwid="footer">...</div></div>'});mt.TweetView=function(b,a){this._updateTime=JW.inScope(this._updateTime,this);this._onLikeClick=JW.inScope(this._onLikeClick,this);this._onRetweetClick=JW.inScope(this._onRetweetClick,this);this._onRemoveClick=JW.inScope(this._onRemoveClick,this);mt.TweetView._super.call(this);this.data=b;this.tweetData=a;this._timer=null;this._likeChangeAttachment=null;this._retweetChangeAttachment=null};JW.extend(mt.TweetView,JW.UI.Component,{renderAvatar:function(a){a.css("background-image","url("+this.tweetData.avatarUrl48+")")},renderTime:function(){this._updateTime();this._timer=setInterval(this._updateTime,30000)},renderFullName:function(a){a.text(this.tweetData.fullName)},renderShortName:function(a){a.text("@"+this.tweetData.shortName)},renderText:function(a){a.html(this.tweetData.contentHtml)},renderLike:function(a){this._updateLike();this._likeChangeAttachment=this.tweetData.likeChangeEvent.bind(this._updateLike,this);a.click(this._onLikeClick)},renderRetweet:function(a){this._updateRetweet();this._retweetChangeAttachment=this.tweetData.retweetChangeEvent.bind(this._updateRetweet,this);a.click(this._onRetweetClick)},renderRemove:function(a){a.click(this._onRemoveClick)},destroyComponent:function(){clearInterval(this._timer);this._retweetChangeAttachment.destroy();this._likeChangeAttachment.destroy();this._super()},_updateTime:function(){var a=new Date().getTime()-this.tweetData.time;var b=this._getTimeString(a);this.getElement("time").text(b)},_updateLike:function(){this.getElement("like").toggleClass("active",this.tweetData.like).text(this.tweetData.like?"Unlike":"Like")},_updateRetweet:function(){this.getElement("retweet").toggleClass("active",this.tweetData.retweet).text(this.tweetData.retweet?"Unretweet":"Retweet")},_onLikeClick:function(a){a.preventDefault();this.tweetData.setLike(!this.tweetData.like)},_onRetweetClick:function(a){a.preventDefault();this.tweetData.setRetweet(!this.tweetData.retweet)},_onRemoveClick:function(a){a.preventDefault();this.data.tweets.removeItem(this.tweetData)},_getTimeString:function(c){var d=c/60000;if(d<1){return"Just now"}if(d<60){return Math.floor(d)+"m"}var a=d/60;if(a<24){return Math.round(a)+"h"}function e(f){return(f<10)?("0"+f):String(f)}var b=new Date(new Date().getTime()-c);return b.getDate()+"."+e(b.getMonth())}});JW.UI.template(mt.TweetView,{main:'<div jwclass="mt-tweet"><div jwid="avatar"></div><div jwid="content"><div jwid="header"><div jwid="full-name"></div><div jwid="short-name"></div><div jwid="time"></div><div class="clear"></div></div><div jwid="text"></div><div jwid="buttons"><a jwid="like" class="mt-tweet-button" href="#"></a><a jwid="retweet" class="mt-tweet-button" href="#"></a><a jwid="remove" class="mt-tweet-button" href="#">Remove</a></div></div><div class="clear"></div></div>'});var dataJson={profile:{fullName:"Road Runner",shortName:"roadrunner",avatarUrl32:"backend/avatar-32.png",avatarUrl48:"backend/avatar-48.png",tweets:380,following:21,followers:27},tweets:[{fullName:"Road Runner",shortName:"roadrunner",avatarUrl48:"backend/avatar-48.png",contentHtml:'jWidget documentation is here <a href="https://enepomnyaschih.github.com/jwidget" target="_blank">enepomnyaschih.github.com/jwidget</a>',timeAgo:215000,like:false,retweet:true},{fullName:"Road Runner",shortName:"roadrunner",avatarUrl48:"backend/avatar-48.png",contentHtml:"Tweet feed is growing",timeAgo:515000,like:false,retweet:false}]};
var data;var application;$(function(){data=mt.Data.createByJson(dataJson);application=new mt.Application(data);application.renderTo("body")});