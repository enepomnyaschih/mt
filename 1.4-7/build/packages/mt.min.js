var mt={};mt.Application=function(a){mt.Application._super.call(this);this.data=a};JW.extend(mt.Application,JW.UI.Component,{renderProfileBox:function(){return this.own(new mt.ProfileBox(this.data))},renderTweets:function(){return this.own(new mt.TweetFeed(this.data))},afterRender:function(){this._super();$("html").addClass("mt-html");$("body").addClass("mt-body")}});(window.viewha||JW.UI).template(mt.Application,{main:'<div jwclass="mt-application"><div jwid="wrap"><div jwid="profile-box"></div><div jwid="tweets"></div><div class="clear"></div></div></div>'});mt.Data=function(){mt.Data._super.call(this);this.profile=null;this.tweets=this.own(new JW.ObservableArray()).ownItems()};JW.extend(mt.Data,JW.Class);mt.Data.createByJson=function(a){var b=new mt.Data();b.profile=b.own(mt.data.Profile.createByJson(a.profile));b.tweets.addAll(JW.Array.map(a.tweets,mt.data.Tweet.createByJson));return b};mt.data={};mt.data.Profile=function(a){mt.data.Profile._super.call(this);this.fullName=a.fullName;this.shortName=a.shortName;this.avatarUrl32=a.avatarUrl32;this.avatarUrl48=a.avatarUrl48;this.tweets=a.tweets;this.following=a.following;this.followers=a.followers};JW.extend(mt.data.Profile,JW.Class);mt.data.Profile.createByJson=function(a){return new mt.data.Profile(a)};mt.data.Tweet=function(a){mt.data.Tweet._super.call(this);this.fullName=a.fullName;this.shortName=a.shortName;this.avatarUrl48=a.avatarUrl48;this.contentHtml=a.contentHtml;this.time=a.time;this.like=this.own(new JW.Property(a.like));this.retweet=this.own(new JW.Property(a.retweet))};JW.extend(mt.data.Tweet,JW.Class);mt.data.Tweet.createByJson=function(a){return new mt.data.Tweet(JW.apply({},a,{time:new Date().getTime()-a.timeAgo}))};mt.ProfileBox=function(a){mt.ProfileBox._super.call(this);this.data=a};JW.extend(mt.ProfileBox,JW.UI.Component,{renderTop:function(a){a.attr("href","https://twitter.com/"+this.data.profile.shortName)},renderAvatar:function(a){a.css("background-image","url("+this.data.profile.avatarUrl32+")")},renderFullName:function(a){a.text(this.data.profile.fullName)},renderTweets:function(a){a.attr("href","https://twitter.com/"+this.data.profile.shortName)},renderTweetsValue:function(a){a.text(this.data.profile.tweets)},renderFollowingValue:function(a){a.text(this.data.profile.following)},renderFollowersValue:function(a){a.text(this.data.profile.followers)},renderComposeForm:function(a){a.jwon("submit",this._onComposeSubmit,this)},_onComposeSubmit:function(a){a.preventDefault();var b=JW.String.trim(this.getElement("compose-input").val());if(!b){return}this.data.tweets.add(new mt.data.Tweet({fullName:this.data.profile.fullName,shortName:this.data.profile.shortName,avatarUrl48:this.data.profile.avatarUrl48,contentHtml:b,time:new Date().getTime(),like:false,retweet:false}),0);this.getElement("compose-input").val("")}});(window.viewha||JW.UI).template(mt.ProfileBox,{main:'<div jwclass="mt-profile-box"><a jwid="top" class="blocklink" href="#" target="_blank"><div jwid="avatar"></div><div jwid="full-name"></div><div jwid="show-profile">Show my profile</div><div class="clear"></div></a><div jwid="middle"><a jwid="count tweets" class="blocklink" href="#" target="_blank"><div jwid="count-value tweets-value"></div><div jwid="count-label">TWEETS</div></a><a jwid="count count-border following" class="blocklink" href="https://twitter.com/following" target="_blank"><div jwid="count-value following-value"></div><div jwid="count-label">FOLLOWING</div></a><a jwid="count count-border followers" class="blocklink" href="https://twitter.com/followers" target="_blank"><div jwid="count-value followers-value"></div><div jwid="count-label">FOLLOWERS</div></a><div class="clear"></div></div><div jwid="bottom"><form jwid="compose-form"><div jwid="compose-fields"><textarea jwid="compose-input" type="text" placeholder="Compose tweet..."></textarea></div><div jwid="compose-buttons"><input jwid="compose-submit" type="submit" value="Tweet"></div></form></div></div>'});mt.TweetFeed=function(a){mt.TweetFeed._super.call(this);this.data=a};JW.extend(mt.TweetFeed,JW.UI.Component,{renderTweets:function(){return this.own(this.data.tweets.$$mapObjects(function(a){return new mt.TweetView(this.data,a)},this))}});(window.viewha||JW.UI).template(mt.TweetFeed,{main:'<div jwclass="mt-tweet-feed"><div jwid="header">Tweets</div><div jwid="tweets"></div><div jwid="footer">...</div></div>'});mt.TweetView=function(b,a){mt.TweetView._super.call(this);this.data=b;this.tweetData=a};JW.extend(mt.TweetView,JW.UI.Component,{renderAvatar:function(a){a.css("background-image","url("+this.tweetData.avatarUrl48+")")},renderTime:function(){this._updateTime();this.own(new JW.Interval(this._updateTime,this,30000))},renderFullName:function(a){a.text(this.tweetData.fullName)},renderShortName:function(a){a.text("@"+this.tweetData.shortName)},renderText:function(a){a.html(this.tweetData.contentHtml)},renderLike:function(a){var b=this.own(this.tweetData.like.$$mapValue(function(c){return c?"Unlike":"Like"},this));this.own(a.jwtext(b));this.own(a.jwclass("active",this.tweetData.like));a.jwon("click",this._onLikeClick,this)},renderRetweet:function(a){var b=this.own(this.tweetData.retweet.$$mapValue(function(c){return c?"Unretweet":"Retweet"},this));this.own(a.jwtext(b));this.own(a.jwclass("active",this.tweetData.retweet));a.jwon("click",this._onRetweetClick,this)},renderRemove:function(a){a.jwon("click",this._onRemoveClick,this)},_updateTime:function(){var a=new Date().getTime()-this.tweetData.time;var b=this._getTimeString(a);this.getElement("time").text(b)},_onLikeClick:function(a){a.preventDefault();this.tweetData.like.set(!this.tweetData.like.get())},_onRetweetClick:function(a){a.preventDefault();this.tweetData.retweet.set(!this.tweetData.retweet.get())},_onRemoveClick:function(a){a.preventDefault();this.data.tweets.removeItem(this.tweetData)},_getTimeString:function(c){var d=c/60000;if(d<1){return"Just now"}if(d<60){return Math.floor(d)+"m"}var a=d/60;if(a<24){return Math.round(a)+"h"}function e(f){return(f<10)?("0"+f):String(f)}var b=new Date(new Date().getTime()-c);return b.getDate()+"."+e(b.getMonth())}});(window.viewha||JW.UI).template(mt.TweetView,{main:'<div jwclass="mt-tweet"><div jwid="avatar"></div><div jwid="content"><div jwid="header"><div jwid="full-name"></div><div jwid="short-name"></div><div jwid="time"></div><div class="clear"></div></div><div jwid="text"></div><div jwid="buttons"><a jwid="button like" href="#"></a><a jwid="button retweet" href="#"></a><a jwid="button remove" href="#">Remove</a></div></div><div class="clear"></div></div>'});var dataJson={profile:{fullName:"Road Runner",shortName:"roadrunner",avatarUrl32:"backend/avatar-32.png",avatarUrl48:"backend/avatar-48.png",tweets:380,following:21,followers:27},tweets:[{fullName:"Road Runner",shortName:"roadrunner",avatarUrl48:"backend/avatar-48.png",contentHtml:'jWidget documentation is here <a href="https://enepomnyaschih.github.com/jwidget" target="_blank">enepomnyaschih.github.com/jwidget</a>',timeAgo:215000,like:false,retweet:true},{fullName:"Road Runner",shortName:"roadrunner",avatarUrl48:"backend/avatar-48.png",contentHtml:"Tweet feed is growing",timeAgo:515000,like:false,retweet:false}]};var data;var application;$(function(){data=mt.Data.createByJson(dataJson);application=new mt.Application(data);application.renderTo("body")});