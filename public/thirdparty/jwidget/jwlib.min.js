/*!
	jWidget Lib 0.5.1
	
	https://github.com/enepomnyaschih/jwidget/wiki
	
	Copyright (C) 2013 Egor Nepomnyaschih
	
	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.
	
	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
if(typeof JW!=="undefined"){throw new Error("Can't initialize jWidget Lib: JW namespace already defined")}(typeof window==="undefined"?global:window).JW={};JW.global=(typeof window==="undefined"?global:window);JW.apply=function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(typeof c[a]!=="undefined"){d[a]=c[a]}}}return d};JW.apply(JW,{isUndefined:function(a){return a===undefined},isDefined:function(a){return a!==undefined},isNull:function(a){return a===null},isNotNull:function(a){return a!==null},isSet:function(a){return(a!==undefined)&&(a!==null)},isNotSet:function(a){return(a===undefined)||(a===null)},isBlank:function(a){return !a},isNotBlank:function(a){return Boolean(a)},isInt:function(a){return(typeof a==="number")&&Math.round(a)===a},isNumber:function(a){return typeof a==="number"},isString:function(a){return typeof a==="string"},isBoolean:function(a){return typeof a==="boolean"},isFunction:function(a){return typeof a==="function"},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isObject:function(a){return Object.prototype.toString.apply(a)==="[object Object]"},isRegExp:function(a){return Object.prototype.toString.apply(a)==="[object RegExp]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},def:function(a,b){return JW.isDefined(a)?a:b},defn:function(a,b){return JW.isSet(a)?a:b},applyIf:function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(JW.isDefined(c[a])&&!JW.isDefined(d[a])){d[a]=c[a]}}}return d},applyIfn:function(d){for(var b=1;b<arguments.length;++b){var c=arguments[b];if(!c){continue}for(var a in c){if(JW.isDefined(c[a])&&!JW.isSet(d[a])){d[a]=c[a]}}}return d},clean:function(c){var a={};for(var b in c){if(JW.isDefined(c[b])){a[b]=c[b]}}return a},cleann:function(c){var a={};for(var b in c){if(JW.isSet(c[b])){a[b]=c[b]}}return a},args:function(b,c,f){c=c||0;f=f||(b.length-c);var e=[];for(var d=0;d<f;++d){e.push(b[c+d])}return e},emptyFn:function(){},cmp:function(b,c,a){if(typeof b==="boolean"&&typeof c==="boolean"){return b?(c?0:1):(c?-1:0)}if(JW.isArray(b)&&JW.isArray(c)){return JW.Array.cmp(b,c,a)}if(a){if(typeof b==="string"){b=b.toLowerCase()}if(typeof c==="string"){c=c.toLowerCase()}}if(b>c){return 1}if(b<c){return -1}return 0},cmpCaseInsensitive:function(a,b){return JW.cmp(a,b,true)},get:function(e,d,c){if(!d){return JW.def(e,c)}if(typeof d==="string"){d=d.split(".")}d=JW.Array.filter(d,function(f){return JW.isSet(f)&&(f!=="")});for(var b=0,a=d.length;b<a;++b){if(!e){return c}e=e[d[b]]}return JW.def(e,c)},set:function(e,c,d){if(!d){return}if(typeof d==="string"){d=d.split(".")}d=JW.Array.filter(d,function(f){return JW.isSet(f)&&(f!=="")});for(var b=0,a=d.length-1;b<a;++b){token=d[b];e[token]=e[token]||{};e=e[token]}e[JW.Array.top(d)]=c},destroy:function(a){a.destroy()},eq:function(a,b){return a==b},seq:function(a,b){return a===b},mod:function(b,a){return b-a*Math.floor(b/a)},smod:function(b,a){return b-a*Math.round(b/a)},sgn:function(a){return !a?0:a>0?1:-1},sgnnz:function(a){return a>=0?1:-1},inScope:function(b,a){return function(){return b.apply(a,arguments)}}});JW.toArray=JW.args;JW.ClassUtil={_iid:0,_fnTest:/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,extend:function(e,c,a){a=a||{};var d=function(){};d.prototype=c.prototype;e.prototype=new d();e.prototype.constructor=e;e.superclass=c.prototype;e._super=c;for(var b in a){e.prototype[b]=JW.ClassUtil.extendMethod(a[b],c.prototype[b])}e.extend=function(g){var h=function(){e.apply(this,arguments)};JW.extend(h,e,g);return h};return e},extendMethod:function(b,a){if((typeof a!=="function")||(typeof b!=="function")||b.superclass||!JW.ClassUtil._fnTest.test(b)){return b}return function(){var d=this._super;this._super=a;var c=b.apply(this,arguments);this._super=d;return c}}};JW.extend=JW.ClassUtil.extend;JW.Class=function(){this._iid=++JW.ClassUtil._iid;this._super=null};JW.extend(JW.Class,Object,{destroy:function(){}});JW.Event=function(){JW.Event._super.call(this);this.attachments={}};JW.extend(JW.Event,JW.Class,{destroy:function(){this.purge()},bind:function(c,a){var b=new JW.EventAttachment(this,c,a);this.attachments[b._iid]=b;return b},unbind:function(a){delete this.attachments[a._iid]},purge:function(){this.attachments={}},trigger:function(c){for(var a in this.attachments){var b=this.attachments[a];b.callback.call(b.scope||b,c)}}});JW.EventAttachment=function(b,c,a){JW.EventAttachment._super.call(this);this.event=b;this.callback=c;this.scope=a};JW.extend(JW.EventAttachment,JW.Class,{destroy:function(){this.event.unbind(this)}});JW.EventParams=function(a){JW.EventParams._super.call(this);this.sender=a};JW.extend(JW.EventParams,JW.Class,{});JW.ItemEventParams=function(a,b){JW.ItemEventParams._super.call(this,a);this.item=b};JW.extend(JW.ItemEventParams,JW.EventParams,{});JW.ValueEventParams=function(a,b){JW.ValueEventParams._super.call(this,a);this.value=b};JW.extend(JW.ValueEventParams,JW.EventParams,{});JW.ItemValueEventParams=function(a,b,c){JW.ItemValueEventParams._super.call(this,a,c);this.item=b};JW.extend(JW.ItemValueEventParams,JW.ValueEventParams,{});JW.Alg={_createBy:function(a){return function(d,c,b){return a(d,function(e){return JW.get(e,c)===b})}},_createByField:function(a){return function(c,b){return a(c,function(d){return JW.get(d,b)})}},_createByMethod:function(a){return function(c,d,b){b=b||[];return a(c,function(e){return e[d].apply(e,b)})}},_every:function(b,c,a){return b.every(c,a)},_createEmpty:function(a){return a.createEmpty()},_createEmptyUnobservable:function(a){return a.createEmptyUnobservable()},_pushItem:function(c,b,a){return c.pushItem(b,a)}};JW.Alg.createSimpleFunctions=function(b){var a={};a.everyBy=JW.Alg._createBy(b);a.everyByMethod=JW.Alg._createByMethod(b);a.each=function(d,e,c){b(d,function(){e.apply(this,arguments)},c);return d};a.forEach=a.each;a.eachByMethod=JW.Alg._createByMethod(a.each);a.forEachByMethod=a.eachByMethod;a.some=function(d,e,c){return !b(d,function(){return e.apply(this,arguments)===false},c)};a.someBy=JW.Alg._createBy(a.some);a.someByMethod=JW.Alg._createByMethod(a.some);a.find=function(e,f,d){var c;b(e,function(h,g){if(f.apply(this,arguments)!==false){c=g;return false}},d);return c};a.findBy=JW.Alg._createBy(a.find);a.findByMethod=JW.Alg._createByMethod(a.find);a.search=function(e,f,d){var c;b(e,function(g){if(f.apply(this,arguments)!==false){c=g;return false}},d);return c};a.searchBy=JW.Alg._createBy(a.search);a.searchByMethod=JW.Alg._createByMethod(a.search);a.indexOf=function(e,d){var c;b(e,function(g,f){if(g===d){c=f;return false}});return c};a.index=function(e,f,d){var c={};b(e,function(h){if(h===undefined){return}var g=f.apply(this,arguments);if(JW.isSet(g)){c[g]=h}},d);return c};a.indexBy=JW.Alg._createByField(a.index);a.indexByMethod=JW.Alg._createByMethod(a.index);a.getKeysArray=function(d){var c=[];b(d,function(f,e){c.push(e)});return c};a.getValuesArray=function(d){var c=[];b(d,function(e){c.push(e)});return c};a.getSize=function(d){var c=0;b(d,function(){++c});return c};a.getLength=a.getSize;a.isEmpty=function(c){return b(c,function(){return false})};return a};JW.Alg.SimpleObjectFunctions=JW.Alg.createSimpleFunctions(JW.Alg._every);
JW.Alg.SimpleMethods={everyBy:function(b,a){return JW.Alg.SimpleObjectFunctions.everyBy(this,b,a)},everyByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.everyByMethod(this,b,a)},each:function(b,a){return JW.Alg.SimpleObjectFunctions.each(this,b,a)},eachByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.eachByMethod(this,b,a)},forEach:function(b,a){return JW.Alg.SimpleObjectFunctions.forEach(this,b,a)},forEachByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.forEachByMethod(this,b,a)},some:function(b,a){return JW.Alg.SimpleObjectFunctions.some(this,b,a)},someBy:function(b,a){return JW.Alg.SimpleObjectFunctions.someBy(this,b,a)},someByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.someByMethod(this,b,a)},find:function(b,a){return JW.Alg.SimpleObjectFunctions.find(this,b,a)},findBy:function(b,a){return JW.Alg.SimpleObjectFunctions.findBy(this,b,a)},findByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.findByMethod(this,b,a)},search:function(b,a){return JW.Alg.SimpleObjectFunctions.search(this,b,a)},searchBy:function(b,a){return JW.Alg.SimpleObjectFunctions.searchBy(this,b,a)},searchByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.searchByMethod(this,b,a)},indexOf:function(a){return JW.Alg.SimpleObjectFunctions.indexOf(this,a)},index:function(b,a){return JW.Alg.SimpleObjectFunctions.index(this,b,a)},indexBy:function(a){return JW.Alg.SimpleObjectFunctions.indexBy(this,a)},indexByMethod:function(b,a){return JW.Alg.SimpleObjectFunctions.indexByMethod(this,b,a)},getKeysArray:function(){return JW.Alg.SimpleObjectFunctions.getKeysArray(this)},getValuesArray:function(){return JW.Alg.SimpleObjectFunctions.getValuesArray(this)},getSize:function(){return JW.Alg.SimpleObjectFunctions.getSize(this)},getLength:function(){return JW.Alg.SimpleObjectFunctions.getLength(this)},isEmpty:function(){return JW.Alg.SimpleObjectFunctions.isEmpty(this)}};JW.Alg.createBuildFunctions=function(d,c,b,e){var a=JW.Alg.createSimpleFunctions(d);a.merge=function(g,f){d(f,function(i,h){e(g,i,h)});return g};a.clone=function(g){var f=c(g);return a.merge(f,g)};a.cloneUnobservable=function(g){var f=b(g);return a.merge(f,g)};a.filter=function(h,i,g){var f=b(h);d(h,function(k,j){if(i.apply(this,arguments)!==false){e(f,k,j)}},g);return f};a.filterBy=JW.Alg._createBy(a.filter);a.filterByMethod=JW.Alg._createByMethod(a.filter);a.map=function(h,i,g){var f=b(h);d(h,function(k,j){e(f,i.apply(this,arguments),j)},g);return f};a.mapBy=JW.Alg._createByField(a.map);a.mapByMethod=JW.Alg._createByMethod(a.map);a.mapFields=function(g){var f={};d(g,function(i){for(var h in i){f[h]=a.mapBy(g,h)}return false});return f};return a};JW.Alg.BuildObjectFunctions=JW.Alg.createBuildFunctions(JW.Alg._every,JW.Alg._createEmpty,JW.Alg._createEmptyUnobservable,JW.Alg._pushItem);JW.Alg.BuildMethods=JW.apply({},JW.Alg.SimpleMethods,{merge:function(a){return JW.Alg.BuildObjectFunctions.merge(this,a)},clone:function(){return JW.Alg.BuildObjectFunctions.clone(this)},cloneUnobservable:function(){return JW.Alg.BuildObjectFunctions.cloneUnobservable(this)},filter:function(b,a){return JW.Alg.BuildObjectFunctions.filter(this,b,a)},filterBy:function(b,a){return JW.Alg.BuildObjectFunctions.filterBy(this,b,a)},filterByMethod:function(b,a){return JW.Alg.BuildObjectFunctions.filterByMethod(this,b,a)},map:function(b,a){return JW.Alg.BuildObjectFunctions.map(this,b,a)},mapBy:function(a){return JW.Alg.BuildObjectFunctions.mapBy(this,a)},mapByMethod:function(b,a){return JW.Alg.BuildObjectFunctions.mapByMethod(this,b,a)},mapFields:function(){return JW.Alg.BuildObjectFunctions.mapFields(this)}});JW.AbstractArray={};JW.AbstractArray.Indexer=function(b,a){JW.AbstractArray.Indexer._super.call(this);a=a||{};this.source=b;this.getKey=a.getKey;this._targetCreated=!a.target;this.target=a.target||this.source.createEmptyMap();this.scope=a.scope;this.target.setAll(this._index(this.source.getItems()))};JW.extend(JW.AbstractArray.Indexer,JW.Class,{destroy:function(){this.target.removeAll(this._keys(this.source.getItems()));if(this._targetCreated){this.target.destroy()}this._super()},_index:function(a){return JW.Array.index(a,this.getKey,this.scope||this)},_keys:function(a){return JW.Array.map(a,this.getKey,this.scope||this)}});JW.AbstractArray.Observer=function(b,a){JW.AbstractArray.Observer._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.clearItems=a.clearItems;this.scope=a.scope||this;this._fill()};JW.extend(JW.AbstractArray.Observer,JW.Class,{destroy:function(){this._clear(this.source.getItems());this._super()},_addItem:function(a){if(this.addItem){this.addItem.call(this.scope||this,a)}},_removeItem:function(a){if(this.removeItem){this.removeItem.call(this.scope||this,a)}},_fill:function(){this.source.every(this._addItem,this)},_clear:function(a){if(a.length===0){return}if(this.clearItems){this.clearItems.call(this.scope||this,a)}else{JW.Array.backEvery(a,this._removeItem,this)}}});JW.AbstractArray.Inserter=function(b,a){JW.AbstractArray.Inserter._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.scope=a.scope;this.clearItems=a.clearItems;this._fill()};JW.extend(JW.AbstractArray.Inserter,JW.Class,{destroy:function(){this._clear(this.source.getItems());this._super()},_addItem:function(b,a){this.addItem.call(this.scope||this,b,a)},_addItems:function(a,b){for(var c=0;c<a.length;++c){this._addItem(a[c],c+b)}},_removeItem:function(b,a){this.removeItem.call(this.scope||this,a,b)},_removeItems:function(a,b){for(var c=a.length-1;c>=0;--c){this._removeItem(a[c],c+b)}},_fill:function(){this._addItems(this.source.getItems().concat(),0)},_clear:function(a){if(a.length===0){return}if(this.clearItems){this.clearItems.call(this.scope||this,a)}else{this._removeItems(a,0)}}});JW.AbstractArray.Lister=function(b,a){JW.AbstractArray.Lister._super.call(this);a=a||{};this.source=b;this._targetCreated=!a.target;this.target=a.target||this.source.createEmptySet();this.target.addAll(this.source.getItems())};JW.extend(JW.AbstractArray.Lister,JW.Class,{destroy:function(){this.target.removeAll(this.source.getItems());if(this._targetCreated){this.target.destroy()}this._super()}});JW.AbstractArray.Mapper=function(b,a){JW.AbstractArray.Mapper._super.call(this);a=a||{};this.source=b;this.createItem=a.createItem;this.destroyItem=a.destroyItem;this._targetCreated=!a.target;this.target=a.target||this.source.createEmpty();this.scope=a.scope;this.target.addAll(this._fill())};JW.extend(JW.AbstractArray.Mapper,JW.Class,{destroy:function(){this._clear(this.source.getItems());if(this._targetCreated){this.target.destroy()}this._super()},_clear:function(a){var b=this.target.clear();for(var c=b.length-1;c>=0;--c){this.destroyItem.call(this.scope||this,b[c],a[c])}},_fill:function(){return JW.Array.map(this.source.getItems(),this.createItem,this.scope||this)}});JW.AbstractArray.Splitter=function(b,a){JW.AbstractArray.Splitter._super.call(this);a=a||{};this.source=b;this._rowsCreated=!a.rows;this.rows=a.rows||this.source.createEmpty();this.capacity=a.capacity||1;this._length=0;this._inserter=this.source.createInserter({addItem:this._addItem,removeItem:this._removeItem,clearItems:this._clearItems,scope:this})};JW.extend(JW.AbstractArray.Splitter,JW.Class,{destroy:function(){this._inserter.destroy();if(this._rowsCreated){this.rows.destroy()}this._super()},createRow:function(){return this.source.createEmpty()},destroyRow:function(a){a.destroy()},_addItem:function(d,b){if(this._length%this.capacity===0){this.rows.add(this.createRow.call(this.scope||this))}var e=Math.floor(b/this.capacity);for(var c=this.rows.getLength()-1;c>e;--c){var a=this.rows.get(c-1).remove(this.capacity-1);this.rows.get(c).add(a,0)}this.rows.get(e).add(d,b%this.capacity);++this._length},_removeItem:function(b){var d=Math.floor(b/this.capacity);this.rows.get(d).remove(b%this.capacity);for(var c=d+1;c<this.rows.getLength();++c){var a=this.rows.get(c).remove(0);this.rows.get(c-1).add(a,this.capacity-1)
}--this._length;if(this._length%this.capacity===0){this.destroyRow.call(this.scope||this,this.rows.remove(this.rows.getLength()-1))}},_clearItems:function(){var a=this.rows.clear();this._length=0;JW.Array.each(a,this.destroyRow,this.scope||this)}});JW.AbstractMap={};JW.AbstractMap.Lister=function(b,a){JW.AbstractMap.Lister._super.call(this);a=a||{};this.source=b;this._targetCreated=!a.target;this.target=a.target||b.createEmptySet();this.target.addAll(this.source.getValuesArray())};JW.extend(JW.AbstractMap.Lister,JW.Class,{destroy:function(){this.target.removeAll(this.source.getValuesArray());if(this._targetCreated){this.target.destroy()}this._super()}});JW.AbstractMap.Mapper=function(b,a){JW.AbstractMap.Mapper._super.call(this);a=a||{};this.source=b;this.createItem=a.createItem;this.destroyItem=a.destroyItem;this._targetCreated=!a.target;this.target=a.target||b.createEmpty();this.scope=a.scope;this._destructionQueue=[];this.target.setAll(JW.Map.map(this.source.getJson(),this.createItem,this.scope||this))};JW.extend(JW.AbstractMap.Mapper,JW.Class,{destroy:function(){if(!this.source.isEmpty()){this.source.every(this._remove,this);this._change()}if(this._targetCreated){this.target.destroy()}this._super()},_remove:function(b,a){this._destructionQueue.push([this.target._remove(a),b,a])},_change:function(){this.target._triggerChange();for(var a=0;a<this._destructionQueue.length;++a){var b=this._destructionQueue[a];this.destroyItem.call(this.scope||this,b[0],b[1],b[2])}this._destructionQueue=[]}});JW.AbstractMap.Observer=function(b,a){JW.AbstractMap.Observer._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.clearItems=a.clearItems;this.scope=a.scope||this;this.source.every(this._addItem,this)};JW.extend(JW.AbstractMap.Observer,JW.Class,{destroy:function(){if(!this.source.isEmpty()){if(this.clearItems){this.clearItems.call(this.scope||this,this.source.getValuesArray())}else{this.source.every(this._removeItem,this)}}this._super()},_addItem:function(a){if(this.addItem){this.addItem.call(this.scope||this,a)}},_removeItem:function(a){if(this.removeItem){this.removeItem.call(this.scope||this,a)}}});JW.AbstractSet={};JW.AbstractSet.Indexer=function(b,a){JW.AbstractSet.Indexer._super.call(this);a=a||{};this.source=b;this.getKey=a.getKey;this._targetCreated=!a.target;this.target=a.target||b.createEmptyMap();this.scope=a.scope;if(!this.source.isEmpty()){this.source.every(this._add,this);this._change()}};JW.extend(JW.AbstractSet.Indexer,JW.Class,{destroy:function(){if(!this.source.isEmpty()){this.source.every(this._remove,this);this._change()}if(this._targetCreated){this.target.destroy()}this._super()},_add:function(a){this.target._set(a,this.getKey.call(this.scope||this,a))},_remove:function(a){this.target._remove(this.getKey.call(this.scope||this,a))},_change:function(){this.target._triggerChange()}});JW.AbstractSet.Mapper=function(b,a){JW.AbstractSet.Mapper._super.call(this);a=a||{};this.source=b;this.createItem=a.createItem;this.destroyItem=a.destroyItem;this._targetCreated=!a.target;this.target=a.target||b.createEmpty();this.scope=a.scope;this._items={};this._destructionQueue=[];this.target.addAll(JW.Array.map(this.source.getValuesArray(),this._createItem,this))};JW.extend(JW.AbstractSet.Mapper,JW.Class,{destroy:function(){if(!this.source.isEmpty()){this.source.every(this._remove,this);this._change()}if(this._targetCreated){this.target.destroy()}this._super()},_createItem:function(b){var a=this.createItem.call(this.scope||this,b);this._items[b._iid]=a;return a},_add:function(a){this.target._add(this._createItem(a))},_remove:function(b){var a=this._items[b._iid];delete this._items[b._iid];this.target._remove(a);this._destructionQueue.push([a,b])},_change:function(){this.target._triggerChange();for(var a=0;a<this._destructionQueue.length;++a){var b=this._destructionQueue[a];this.destroyItem.call(this.scope||this,b[0],b[1])}this._destructionQueue=[]}});JW.AbstractSet.Observer=function(b,a){JW.AbstractSet.Observer._super.call(this);a=a||{};this.source=b;this.addItem=a.addItem;this.removeItem=a.removeItem;this.clearItems=a.clearItems;this.scope=a.scope||this;this.source.every(this._addItem,this)};JW.extend(JW.AbstractSet.Observer,JW.Class,{destroy:function(){if(!this.source.isEmpty()){if(this.clearItems){this.clearItems.call(this.scope||this,this.source.getValuesArray())}else{this.source.every(this._removeItem,this)}}this._super()},_addItem:function(a){if(this.addItem){this.addItem.call(this.scope||this,a)}},_removeItem:function(a){if(this.removeItem){this.removeItem.call(this.scope||this,a)}}});JW.Array=function(a){JW.Array._super.call(this);this.items=a?a.concat():[]};JW.extend(JW.Array,JW.Class,{get:function(a){return this.items[a]},set:function(b,a){return JW.Array.set(this.items,b,a)},add:function(b,a){JW.Array.add(this.items,b,a)},addAll:function(a,b){JW.Array.addAll(this.items,a,b)},remove:function(a,b){return JW.Array.remove(this.items,a,b)},move:function(a,b){return JW.Array.move(this.items,a,b)},clear:function(){return JW.Array.clear(this.items)},every:function(b,a){return JW.Array.every(this.items,b,a)},backEvery:function(b,a){return JW.Array.backEvery(this.items,b,a)},createEmpty:function(){return new JW.Array()},createEmptyUnobservable:function(){return new JW.Array()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()},removeItem:function(a){return JW.Array.removeItem(this.items,a)},equal:function(a){return JW.Array.equal(this.items,a)},sortBy:function(b,a){return JW.Array.sortBy(this.items,b,a)},top:function(){return JW.Array.top(this.items)},pop:function(){return this.items.pop()},collapse:function(a){return JW.Array.collapse(this.items,a)},indexOf:function(a){return JW.Array.indexOf(this.items,a)},getSize:function(){return this.items.length},isEmpty:function(){return this.items.length===0},clone:function(){return new JW.Array(this.items.concat())},getItems:function(){return this.items},createIndexer:function(a){return new JW.AbstractArray.Indexer(this,a)},createObserver:function(a){return new JW.AbstractArray.Observer(this,a)},createInserter:function(a){return new JW.AbstractArray.Inserter(this,a)},createLister:function(a){return new JW.AbstractArray.Lister(this,a)},createMapper:function(a){return new JW.AbstractArray.Mapper(this,a)},createSplitter:function(a){return new JW.AbstractArray.Splitter(this,a)},_perform:function(c,b){var a=c.call(b||this,this.items);if(a&&(a!==this.items)){JW.Array.clear(this.items);JW.Array.addAll(this.items,a)}}});JW.Array.prototype.getLength=JW.Array.prototype.getSize;JW.Array.prototype.pushItem=JW.Array.prototype.add;JW.Array.prototype.performReorder=JW.Array.prototype._perform;JW.Array.prototype.performFilter=JW.Array.prototype._perform;JW.Array.prototype.performReset=JW.Array.prototype._perform;JW.applyIf(JW.Array.prototype,JW.Alg.BuildMethods);JW.apply(JW.Array,{set:function(d,b,a){var c=d[a];d[a]=b;return c},add:function(c,b,a){c.splice(JW.def(a,c.length),0,b)},addAll:function(c,a,b){c.splice.apply(c,[JW.def(b,c.length),0].concat(a))},remove:function(d,b,c){var a=d.splice(b,JW.def(c,1));return(c===undefined)?a[0]:a},move:function(d,a,c){var b=d[a];if(a===c){return b}d.splice(a,1);d.splice(c,0,b);return b},clear:function(a){return a.splice(0,a.length)},every:function(d,e,c){for(var b=0,a=d.length;b<a;++b){if(e.call(c||d,d[b],b)===false){return false}}return true},backEvery:function(c,d,b){for(var a=c.length-1;a>=0;--a){if(d.call(b||c,c[a],a)===false){return false}}return true},removeItem:function(c,b){var a=JW.Array.indexOf(c,b);if(a!==undefined){c.splice(a,1)}return a},equal:function(d,a){if(d===a){return true}if(d.length!==a.length){return false}for(var c=0,b=d.length;c<b;++c){if(d[c]!==a[c]){return false}}return true},sortBy:function(c,b,a){a=a||1;c.sort(function(d,e){return JW.cmp(JW.get(d,b),JW.get(e,b))*a});return c},top:function(a){return a[a.length-1]},pop:function(a){return a.pop()
},collapse:function(d,e){var a=[];for(var c=0,b=d.length;c<b;++c){if(!JW.isArray(d[c])){a.push(d[c]);continue}if(!JW.isSet(e)){JW.Array.addAll(a,JW.Array.collapse(d[c]));continue}if(e){JW.Array.addAll(a,JW.Array.collapse(d[c],e-1));continue}a.push(d[c])}return a},indexOf:Array.prototype.indexOf?function(c,b){var a=c.indexOf(b);return(a===-1)?undefined:a}:function(d,c){for(var b=0,a=d.length;b<a;++b){if(d[b]===c){return b}}return undefined},getSize:function(a){return a?a.length:0},isEmpty:function(a){return a?(a.length===0):true},clone:function(a){return a.concat()},cmp:function(c,f,b){var e=Math.min(c.length,f.length);for(var d=0;d<e;++d){var a=JW.cmp(c[d],f[d],b);if(a){return a}}return JW.cmp(c.length,f.length)},shuffle:function(e){var a=new Array(e);for(var d=0;d<e;++d){a[d]=d}for(var d=0;d<e;++d){var b=d+Math.floor(Math.random()*(e-d));var c=a[d];a[d]=a[b];a[b]=c}return a}});JW.Array.getLength=JW.Array.getSize;JW.applyIf(JW.Array,JW.Alg.createBuildFunctions(JW.Array.every,function(){return[]},function(){return[]},function(b,a){b.push(a)}));JW.Map=function(a){JW.Map._super.call(this);this.json={};this.size=0;if(a){this.setAll(a)}};JW.extend(JW.Map,JW.Class,{getJson:function(){return this.json},getSize:function(){return this.size},isEmpty:function(){return this.size===0},contains:function(a){return this.json.hasOwnProperty(a)},get:function(a){return this.json[a]},set:function(b,a){if(b===undefined){return false}var c=this.json[a];if(c===b){return false}if(c===undefined){++this.size}this.json[a]=b;return true},setAll:function(b){var c=false;for(var a in b){c=this.set(b[a],a)||c}return c},remove:function(a){var b=this.json[a];if(b!==undefined){delete this.json[a];--this.size}return b},removeItem:function(b){var a=this.indexOf(b);if(a!==undefined){delete this.json[a];--this.size}return a},removeAll:function(c){var d=false;for(var b=0,a=c.length;b<a;++b){d=this.remove(c[b])||d}return d},clear:function(){if(this.size===0){return false}this.json={};this.size=0;return true},every:function(b,a){return JW.Map.every(this.json,b,a)},createEmpty:function(){return new JW.Map()},createEmptyUnobservable:function(){return new JW.Map()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()},createLister:function(a){return new JW.AbstractMap.Lister(this,a)},createMapper:function(a){return new JW.AbstractMap.Mapper(this,a)},createObserver:function(a){return new JW.AbstractMap.Observer(this,a)},equal:function(c){if(this===c){return true}if(this.getSize()!==c.getSize()){return false}var b=this.json;for(var a in b){if(c.get(a)!==b[a]){return false}}return true},_triggerChange:function(){}});JW.Map.prototype.getLength=JW.Map.prototype.getSize;JW.Map.prototype.pushItem=JW.Map.prototype.set;JW.Map.prototype._set=JW.Map.prototype.set;JW.Map.prototype._remove=JW.Map.prototype.remove;JW.Map.prototype._setAll=JW.Map.prototype.setAll;JW.Map.prototype._removeAll=JW.Map.prototype.removeAll;JW.applyIf(JW.Map.prototype,JW.Alg.BuildMethods);JW.apply(JW.Map,{get:function(b,a){return b[a]},set:function(c,b,a){if((b===undefined)||(c[a]===b)){return false}c[a]=b;return true},setAll:function(c,b){var d=false;for(var a in b){d=JW.Map.set(c,b[a],a)||d}return d},remove:function(c,a){var b=c[a];delete c[a];return b},removeItem:function(c,b){var a=JW.Map.indexOf(c,b);if(a!==undefined){delete c[a]}return a},removeAll:function(d,c){var e=false;for(var b=0,a=c.length;b<a;++b){e=JW.Map.remove(d,c[b])||e}return e},clear:function(c){var b=[];for(var a in c){b.push(a)}return JW.Map.removeAll(b)},every:function(c,d,b){for(var a in c){if(d.call(b||c,c[a],a,c)===false){return false}}return true},equal:function(a,d){if(a===d){return true}var c=JW.Map.getSize(d);for(var b in a){if((--c<0)||(a[b]!==d[b])){return false}}return c===0},clone:function(a){return JW.apply({},a)}});JW.applyIf(JW.Map,JW.Alg.createBuildFunctions(JW.Map.every,function(){return{}},function(){return{}},function(c,b,a){c[a]=b}));JW.Set=function(a){JW.Set._super.call(this);this.json={};this.size=0;if(a){this._addAll(a)}};JW.extend(JW.Set,JW.Class,{getJson:function(){return this.json},getSize:function(){return this.size},isEmpty:function(){return this.size===0},contains:function(a){return this.json.hasOwnProperty(a._iid)},add:function(a){if(!this.json.hasOwnProperty(a._iid)){this.json[a._iid]=a;++this.size}},addAll:function(b){for(var c=0,a=b.length;c<a;++c){this.add(b[c])}},remove:function(a){if(this.json.hasOwnProperty(a._iid)){delete this.json[a._iid];--this.size}},removeAll:function(b){for(var c=0,a=b.length;c<a;++c){this.remove(b[c])}},clear:function(){this.json={};this.size=0},every:function(b,a){return JW.Set.every(this.json,b,a)},createEmpty:function(){return new JW.Set()},createEmptyUnobservable:function(){return new JW.Set()},createEmptyArray:function(){return new JW.Array()},createEmptyMap:function(){return new JW.Map()},createEmptySet:function(){return new JW.Set()},createIndexer:function(a){return new JW.AbstractSet.Indexer(this,a)},createMapper:function(a){return new JW.AbstractSet.Mapper(this,a)},createObserver:function(a){return new JW.AbstractSet.Observer(this,a)},equal:function(b){if(this===b){return true}if(this.getSize()!==b.getSize()){return false}for(var a in this.json){if(!b.json.hasOwnProperty(a)){return false}}return true},_triggerChange:function(){}});JW.Set.prototype.getLength=JW.Set.prototype.getSize;JW.Set.prototype.pushItem=JW.Set.prototype.add;JW.Set.prototype.removeItem=JW.Set.prototype.remove;JW.Set.prototype._add=JW.Set.prototype.add;JW.Set.prototype._addAll=JW.Set.prototype.addAll;JW.Set.prototype._remove=JW.Set.prototype.remove;JW.Set.prototype._removeAll=JW.Set.prototype.removeAll;JW.applyIf(JW.Set.prototype,JW.Alg.BuildMethods);JW.apply(JW.Set,{contains:function(b,a){return b.hasOwnProperty(a._iid)},add:function(b,a){b[a._iid]=a},addAll:function(e,b){for(var c=0,a=b.length;c<a;++c){var d=b[c];e[d._iid]=d}},remove:function(b,a){delete b[a._iid]},removeAll:function(d,b){for(var c=0,a=b.length;c<a;++c){delete d[b[c]._iid]}},clear:JW.Map.clear,every:function(c,d,b){for(var a in c){if(d.call(b||c,c[a],undefined,c)===false){return false}}return true},equal:function(a,d){if(a===d){return true}var b=JW.Set.getSize(d);for(var c in a){if((--b<0)||!d.hasOwnProperty(c)){return false}}return b===0},clone:JW.Map.clone});JW.Set.removeItem=JW.Set.remove;JW.applyIf(JW.Set,JW.Alg.createBuildFunctions(JW.Set.every,function(){return{}},function(){return{}},function(b,a){b[a._iid]=a}));JW.ObservableArray=function(a){JW.ObservableArray._super.call(this);this.array=[];this.addEvent=new JW.Event();this.removeEvent=new JW.Event();this.replaceEvent=new JW.Event();this.moveEvent=new JW.Event();this.clearEvent=new JW.Event();this.reorderEvent=new JW.Event();this.filterEvent=new JW.Event();this.resetEvent=new JW.Event();this.changeEvent=new JW.Event();this.lengthChangeEvent=new JW.Event();this.bulkCount=0;this.bulkDirty=false;this.bulkLength=0;if(a){this.addAll(a)}};JW.extend(JW.ObservableArray,JW.Class,{destroy:function(){this.clear();this.lengthChangeEvent.destroy();this.changeEvent.destroy();this.resetEvent.destroy();this.filterEvent.destroy();this.reorderEvent.destroy();this.clearEvent.destroy();this.moveEvent.destroy();this.replaceEvent.destroy();this.removeEvent.destroy();this.addEvent.destroy();this._super()},getSize:function(){return this.array.length},isEmpty:function(){return this.array.length===0},get:function(a){return this.array[a]},add:function(b,a){if(a===undefined){a=this.getLength()}this.array.splice(a,0,b);this.addEvent.trigger(new JW.ObservableArray.ItemRangeEventParams(this,[b],a));this._triggerChange()},addAll:function(a,b){if(a.length===0){return}if(b===undefined){b=this.getLength()}JW.Array.addAll(this.array,a,b);this.addEvent.trigger(new JW.ObservableArray.ItemRangeEventParams(this,a,b));this._triggerChange()},remove:function(b,c){var a=this.array.splice(b,JW.def(c,1));this.removeEvent.trigger(new JW.ObservableArray.ItemRangeEventParams(this,a,b));
this._triggerChange();return(c===undefined)?a[0]:a},removeItem:function(b){var a=this.indexOf(b);if(a!==undefined){this.remove(a)}return a},set:function(b,a){var c=this.array[a];if(c===b){return c}this.array[a]=b;this.replaceEvent.trigger(new JW.ObservableArray.ReplaceEventParams(this,a,c,b));this._triggerChange();return c},move:function(a,c){var b=this.array[a];if(a===c){return b}JW.Array.move(this.array,a,c);this.moveEvent.trigger(new JW.ObservableArray.MoveEventParams(this,a,c,b));this._triggerChange();return b},clear:function(){if(this.isEmpty()){return[]}var a=JW.Array.clear(this.array);this.clearEvent.trigger(new JW.ObservableArray.ItemsEventParams(this,a));this._triggerChange();return a},performReorder:function(b,a){this._perform(this.reorderEvent,b,a)},performFilter:function(b,a){this._perform(this.filterEvent,b,a)},performReset:function(b,a){this._perform(this.resetEvent,b,a)},startBulkChange:function(){if(this.bulkCount===0){this.bulkDirty=false}++this.bulkCount},stopBulkChange:function(){if(this.bulkCount===0){return}--this.bulkCount;if(this.bulkDirty){this._triggerChange()}},every:function(b,a){return JW.Array.every(this.array,b,a)},backEvery:function(b,c,a){return JW.Array.backEvery(this.array,c,a)},top:function(){return JW.Array.top(this.array)},pop:function(){var a=this.getLength();return(a===0)?undefined:this.remove(a-1)},createEmpty:function(){return new JW.ObservableArray()},createEmptyUnobservable:function(){return new JW.Array()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},getItems:function(){return this.array},createIndexer:function(a){return new JW.ObservableArray.Indexer(this,a)},createObserver:function(a){return new JW.ObservableArray.Observer(this,a)},createInserter:function(a){return new JW.ObservableArray.Inserter(this,a)},createLister:function(a){return new JW.ObservableArray.Lister(this,a)},createMapper:function(a){return new JW.ObservableArray.Mapper(this,a)},createSplitter:function(a){return new JW.ObservableArray.Splitter(this,a)},_triggerChange:function(){if(this.bulkCount!==0){this.bulkDirty=true;return}this.changeEvent.trigger(new JW.ObservableArray.EventParams(this));var a=this.getLength();if(this.bulkLength!==a){this.lengthChangeEvent.trigger(new JW.ObservableArray.LengthChangeEventParams(this,this.bulkLength,a));this.bulkLength=a}},_perform:function(c,e,b){var d=new JW.ObservableArray.ItemsEventParams(this,this.array.concat());var a=e.call(b||this,this.array);if(a&&(a!==this.array)){JW.Array.clear(this.array);JW.Array.addAll(this.array,a)}c.trigger(d);this._triggerChange()}});JW.ObservableArray.prototype.getLength=JW.ObservableArray.prototype.getSize;JW.ObservableArray.prototype.pushItem=JW.ObservableArray.prototype.add;JW.apply(JW.ObservableArray.prototype,JW.Alg.BuildMethods);JW.ObservableArray.EventParams=function(a){JW.ObservableArray.EventParams._super.call(this,a)};JW.extend(JW.ObservableArray.EventParams,JW.EventParams,{});JW.ObservableArray.ItemRangeEventParams=function(c,a,b){JW.ObservableArray.ItemRangeEventParams._super.call(this,c);this.items=a;this.index=b};JW.extend(JW.ObservableArray.ItemRangeEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.ItemsEventParams=function(b,a){JW.ObservableArray.ItemsEventParams._super.call(this,b);this.items=a};JW.extend(JW.ObservableArray.ItemsEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.LengthChangeEventParams=function(a,b,c){JW.ObservableArray.LengthChangeEventParams._super.call(this,a);this.oldLength=b;this.newLength=c};JW.extend(JW.ObservableArray.LengthChangeEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.MoveEventParams=function(a,b,d,c){JW.ObservableArray.MoveEventParams._super.call(this,a);this.fromIndex=b;this.toIndex=d;this.item=c};JW.extend(JW.ObservableArray.MoveEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.ReplaceEventParams=function(c,a,d,b){JW.ObservableArray.ReplaceEventParams._super.call(this,c);this.index=a;this.oldItem=d;this.newItem=b};JW.extend(JW.ObservableArray.ReplaceEventParams,JW.ObservableArray.EventParams,{});JW.ObservableArray.Indexer=function(b,a){JW.ObservableArray.Indexer._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._replaceEventAttachment=this.source.replaceEvent.bind(this._onReplace,this);this._clearEventAttachment=this.source.clearEvent.bind(this._onClear,this);this._filterEventAttachment=this.source.filterEvent.bind(this._onFilter,this);this._resetEventAttachment=this.source.resetEvent.bind(this._onReset,this)};JW.extend(JW.ObservableArray.Indexer,JW.AbstractArray.Indexer,{destroy:function(){this._resetEventAttachment.destroy();this._filterEventAttachment.destroy();this._clearEventAttachment.destroy();this._replaceEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this.target.setAll(this._index(a.items))},_onRemove:function(a){this.target.removeAll(this._keys(a.items))},_onReplace:function(a){this.target._remove(this.getKey.call(this.scope||this,a.oldItem));this.target._set(a.newItem,this.getKey.call(this.scope||this,a.newItem));this.target._triggerChange()},_onClear:function(a){this.target.removeAll(this._keys(a.items))},_onFilter:function(c){var b=this._index(this.source.array);var a=this._keys(c.items);this.target.removeAll(JW.Array.filter(a,function(d){return !b.hasOwnProperty(d)},this))},_onReset:function(a){this.target._removeAll(this._keys(a.items));this.target._setAll(this._index(this.source.array));this.target._triggerChange()}});JW.ObservableArray.Observer=function(b,a){JW.ObservableArray.Observer._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._replaceEventAttachment=this.source.replaceEvent.bind(this._onReplace,this);this._clearEventAttachment=this.source.clearEvent.bind(this._onClear,this);this._filterEventAttachment=this.source.filterEvent.bind(this._onFilter,this);this._resetEventAttachment=this.source.resetEvent.bind(this._onReset,this)};JW.extend(JW.ObservableArray.Observer,JW.AbstractArray.Observer,{destroy:function(){this._resetEventAttachment.destroy();this._filterEventAttachment.destroy();this._clearEventAttachment.destroy();this._replaceEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){JW.Array.every(a.items,this._addItem,this)},_onRemove:function(a){JW.Array.every(a.items,this._removeItem,this)},_onReplace:function(a){this._removeItem(a.oldItem);this._addItem(a.newItem)},_onClear:function(a){this._clear(a.items)},_onFilter:function(f){var g=this.source.array;var c=f.items;if(this.clearItems&&(3*g.length<c.length)){this._clear(c);this._fill();return}var b=0;for(var e=0,a=c.length;e<a;++e){var d=c[e];if(d===g[b]){++b}else{this._removeItem(d)}}},_onReset:function(a){this._clear(a.items);this._fill()}});JW.ObservableArray.Inserter=function(b,a){JW.ObservableArray.Inserter._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._replaceEventAttachment=this.source.replaceEvent.bind(this._onReplace,this);this._moveEventAttachment=this.source.moveEvent.bind(this._onMove,this);this._clearEventAttachment=this.source.clearEvent.bind(this._onClear,this);this._reorderEventAttachment=this.source.reorderEvent.bind(this._onReorder,this);this._filterEventAttachment=this.source.filterEvent.bind(this._onFilter,this);this._resetEventAttachment=this.source.resetEvent.bind(this._onReset,this)};JW.extend(JW.ObservableArray.Inserter,JW.AbstractArray.Inserter,{destroy:function(){this._resetEventAttachment.destroy();
this._filterEventAttachment.destroy();this._reorderEventAttachment.destroy();this._clearEventAttachment.destroy();this._moveEventAttachment.destroy();this._replaceEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this._addItems(a.items,a.index)},_onRemove:function(a){this._removeItems(a.items,a.index)},_onReplace:function(a){this._removeItem(a.oldItem,a.index);this._addItem(a.newItem,a.index)},_onMove:function(a){this._removeItem(a.item,a.fromIndex);this._addItem(a.item,a.toIndex)},_onClear:function(a){this._clear(a.items)},_onReorder:function(a){this._clear(a.items);this._fill()},_onFilter:function(f){var g=this.source.array;var c=f.items;if(this.clearItems&&(3*g.length<c.length)){this._clear(c);this._fill();return}var b=0;for(var e=0,a=c.length;e<a;++e){var d=c[e];if(d===g[b]){++b}else{this._removeItem(d,b)}}},_onReset:function(a){this._clear(a.items);this._fill()}});JW.ObservableArray.Lister=function(b,a){JW.ObservableArray.Lister._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._replaceEventAttachment=this.source.replaceEvent.bind(this._onReplace,this);this._clearEventAttachment=this.source.clearEvent.bind(this._onClear,this);this._filterEventAttachment=this.source.filterEvent.bind(this._onFilter,this);this._resetEventAttachment=this.source.resetEvent.bind(this._onReset,this)};JW.extend(JW.ObservableArray.Lister,JW.AbstractArray.Lister,{destroy:function(){this._resetEventAttachment.destroy();this._filterEventAttachment.destroy();this._clearEventAttachment.destroy();this._replaceEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this.target.addAll(a.items)},_onRemove:function(a){this.target.removeAll(a.items)},_onReplace:function(a){this.target._remove(a.oldItem);this.target._add(a.newItem);this.target._triggerChange()},_onClear:function(a){this.target.removeAll(a.items)},_onFilter:function(){var d=JW.Array.indexBy(this.source.array,"_iid");var a=[];var b=this.target.getJson();for(var c in b){if(!d.hasOwnProperty(c)){a.push(b[c])}}this.target.removeAll(a)},_onReset:function(a){this.target._removeAll(a.items);this.target._addAll(this.source.array);this.target._triggerChange()}});JW.ObservableArray.Mapper=function(b,a){JW.ObservableArray.Mapper._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._replaceEventAttachment=this.source.replaceEvent.bind(this._onReplace,this);this._moveEventAttachment=this.source.moveEvent.bind(this._onMove,this);this._clearEventAttachment=this.source.clearEvent.bind(this._onClear,this);this._reorderEventAttachment=this.source.reorderEvent.bind(this._onReorder,this);this._filterEventAttachment=this.source.filterEvent.bind(this._onFilter,this);this._resetEventAttachment=this.source.resetEvent.bind(this._onReset,this)};JW.extend(JW.ObservableArray.Mapper,JW.AbstractArray.Mapper,{destroy:function(){this._addEventAttachment.destroy();this._removeEventAttachment.destroy();this._replaceEventAttachment.destroy();this._moveEventAttachment.destroy();this._clearEventAttachment.destroy();this._reorderEventAttachment.destroy();this._filterEventAttachment.destroy();this._resetEventAttachment.destroy();this._super()},getKey:function(a){return a._iid||a},_onAdd:function(c){var a=new Array(c.items.length);for(var b=0;b<a.length;++b){a[b]=this.createItem.call(this.scope||this,c.items[b])}this.target.addAll(a,c.index)},_onRemove:function(c){var a=this.target.remove(c.index,c.items.length);for(var b=0;b<a.length;++b){this.destroyItem.call(this.scope||this,a[b],c.items[b])}},_onReplace:function(c){var a=this.createItem.call(this.scope||this,c.newItem);var b=this.target.set(a,c.index);this.destroyItem.call(this.scope||this,b,c.oldItem)},_onMove:function(a){this.target.move(a.fromIndex,a.toIndex)},_onClear:function(a){this._clear(a.items)},_onReorder:function(a){this.target.performReorder(function(d){var b=a.items;var e={};for(var g=0,c=b.length;g<c;++g){var j=b[g];var h=d[g];var f=this.getKey.call(this.scope||this,j);e[f]=e[f]||[];e[f].push([j,h])}JW.Array.clear(d);JW.Array.every(this.source.array,function(m,k){var i=e[this.getKey.call(this.scope||this,m)];var n=JW.Array.searchBy(i,"0",m);var l=n[1];d.push(l)},this)},this)},_onFilter:function(d){var b=[];this.target.performFilter(function(h){var f=d.items;var g=JW.Array.clear(h);var e=0;JW.Array.every(f,function(i,j){var k=g[j];var l=this.source.get(e);if(i!==l){b.push([k,i]);return}h.push(k);++e},this)},this);for(var a=0;a<b.length;++a){var c=b[a];this.destroyItem.call(this.scope||this,c[0],c[1])}},_onReset:function(d){var a=d.items;var b;this.target.performReset(function(e){b=JW.Array.clear(e);JW.Array.addAll(e,this._fill())},this);for(var c=0;c<b.length;++c){this.destroyItem.call(this.scope||this,b[c],a[c])}}});JW.ObservableArray.Splitter=JW.AbstractArray.Splitter.extend();JW.ObservableMap=function(a){JW.ObservableMap._super.call(this);this._map=new JW.Map();this.addEvent=new JW.Event();this.removeEvent=new JW.Event();this.changeEvent=new JW.Event();this.sizeChangeEvent=new JW.Event();this.bulkCount=0;this.bulkDirty=false;if(a){this._setAll(a)}this.bulkSize=this._map.size};JW.extend(JW.ObservableMap,JW.Class,{destroy:function(){this.clear();this.sizeChangeEvent.destroy();this.changeEvent.destroy();this.removeEvent.destroy();this.addEvent.destroy();this._super()},getJson:function(){return this._map.getJson()},getSize:function(){return this._map.size},isEmpty:function(){return this._map.size===0},contains:function(a){return this._map.json.hasOwnProperty(a)},get:function(a){return this._map.json[a]},set:function(b,a){if(this._set(b,a)){this._triggerChange();return true}return false},setAll:function(a){if(this._setAll(a)){this._triggerChange();return true}return false},remove:function(a){var b=this._remove(a);if(b!==undefined){this._triggerChange()}return b},removeItem:function(b){var a=this.indexOf(b);if(a!==undefined){this.remove(a)}return a},removeAll:function(a){if(this._removeAll(a)){this._triggerChange();return true}return false},clear:function(){if(this._clear()){this._triggerChange();return true}return false},startBulkChange:function(){++this.bulkCount;if(this.bulkCount!==1){return}this.bulkDirty=false},stopBulkChange:function(){if(this.bulkCount===0){return}--this.bulkCount;if(this.bulkDirty){this._triggerChange()}},every:function(b,a){return JW.Map.every(this._map.json,b,a)},createEmpty:function(){return new JW.ObservableMap()},createEmptyUnobservable:function(){return new JW.Map()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},createLister:function(a){return new JW.ObservableMap.Lister(this,a)},createMapper:function(a){return new JW.ObservableMap.Mapper(this,a)},createObserver:function(a){return new JW.ObservableMap.Observer(this,a)},_set:function(b,a){if(b===undefined){return false}var c=this._map.json[a];if(c===b){return false}this._remove(a);this._map.set(b,a);this.addEvent.trigger(new JW.ObservableMap.ItemEventParams(this,b,a));return true},_setAll:function(b){var c=false;for(var a in b){c=this._set(b[a],a)||c}return c},_remove:function(a){var b=this._map.json[a];if(b===undefined){return undefined}this._map.remove(a);this.removeEvent.trigger(new JW.ObservableMap.ItemEventParams(this,b,a));return b},_removeAll:function(c){var d=false;for(var b=0,a=c.length;b<a;++b){d=(this._remove(c[b])===undefined)?d:true}return d},_clear:function(){if(this._map.size===0){return false}var b=JW.Map.clone(this._map.json);for(var a in b){this._remove(a)}return true},_triggerChange:function(){if(this.bulkCount!==0){this.bulkDirty=true;return}this.changeEvent.trigger(new JW.ObservableMap.EventParams(this));
if(this.bulkSize!==this._map.size){this.sizeChangeEvent.trigger(new JW.ObservableMap.SizeChangeEventParams(this,this.bulkSize,this._map.size));this.bulkSize=this._map.size}}});JW.ObservableMap.prototype.getLength=JW.ObservableMap.prototype.getSize;JW.ObservableMap.prototype.pushItem=JW.ObservableMap.prototype.set;JW.applyIf(JW.ObservableMap.prototype,JW.Alg.BuildMethods);JW.ObservableMap.EventParams=function(a){JW.ObservableMap.EventParams._super.call(this,a)};JW.extend(JW.ObservableMap.EventParams,JW.EventParams,{});JW.ObservableMap.ItemEventParams=function(b,c,a){JW.ObservableMap.ItemEventParams._super.call(this,b);this.item=c;this.key=a};JW.extend(JW.ObservableMap.ItemEventParams,JW.ObservableMap.EventParams,{});JW.ObservableMap.SizeChangeEventParams=function(b,c,a){JW.ObservableMap.SizeChangeEventParams._super.call(this,b);this.oldSize=c;this.newSize=a};JW.extend(JW.ObservableMap.SizeChangeEventParams,JW.ObservableMap.EventParams,{});JW.ObservableMap.Lister=function(b,a){JW.ObservableMap.Lister._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._changeEventAttachment=this.source.changeEvent.bind(this._onChange,this)};JW.extend(JW.ObservableMap.Lister,JW.AbstractMap.Lister,{destroy:function(){this._changeEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this.target._add(a.item)},_onRemove:function(a){this.target._remove(a.item)},_onChange:function(){this.target._triggerChange()}});JW.ObservableMap.Mapper=function(b,a){JW.ObservableMap.Mapper._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._changeEventAttachment=this.source.changeEvent.bind(this._onChange,this)};JW.extend(JW.ObservableMap.Mapper,JW.AbstractMap.Mapper,{destroy:function(){this._changeEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this.target._set(this.createItem.call(this.scope||this,a.item,a.key),a.key)},_onRemove:function(a){this._remove(a.item,a.key)},_onChange:function(a){this._change()}});JW.ObservableMap.Observer=function(b,a){JW.ObservableMap.Observer._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this)};JW.extend(JW.ObservableMap.Observer,JW.AbstractMap.Observer,{destroy:function(){this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this._addItem(a.item)},_onRemove:function(a){this._removeItem(a.item)}});JW.ObservableSet=function(a){JW.ObservableSet._super.call(this);this.set=new JW.Set();this.addEvent=new JW.Event();this.removeEvent=new JW.Event();this.changeEvent=new JW.Event();this.sizeChangeEvent=new JW.Event();this.bulkCount=0;this.bulkDirty=false;if(a){this._addAll(a)}this.bulkSize=this.set.size};JW.extend(JW.ObservableSet,JW.Class,{destroy:function(){this.clear();this.sizeChangeEvent.destroy();this.changeEvent.destroy();this.removeEvent.destroy();this.addEvent.destroy();this._super()},getJson:function(){return this.set.getJson()},getSize:function(){return this.set.size},isEmpty:function(){return this.set.size===0},contains:function(a){return this.set.json.hasOwnProperty(a._iid)},add:function(a){if(this._add(a)){this._triggerChange();return true}return false},addAll:function(a){if(this._addAll(a)){this._triggerChange();return true}return false},remove:function(a){if(this._remove(a)){this._triggerChange();return true}return false},removeItem:function(a){this.remove(a)},removeAll:function(b){var d=false;for(var c=0,a=b.length;c<a;++c){d=this._remove(b[c])||d}if(d){this._triggerChange();return true}return false},clear:function(){if(this._clear()){this._triggerChange();return true}return false},startBulkChange:function(){++this.bulkCount;if(this.bulkCount!==1){return}this.bulkDirty=false},stopBulkChange:function(){if(this.bulkCount===0){return}--this.bulkCount;if(this.bulkDirty){this._triggerChange()}},every:function(b,a){return JW.Set.every(this.set.json,b,a)},createEmpty:function(){return new JW.ObservableSet()},createEmptyUnobservable:function(){return new JW.Set()},createEmptyArray:function(){return new JW.ObservableArray()},createEmptyMap:function(){return new JW.ObservableMap()},createEmptySet:function(){return new JW.ObservableSet()},createIndexer:function(a){return new JW.ObservableSet.Indexer(this,a)},createMapper:function(a){return new JW.ObservableSet.Mapper(this,a)},createObserver:function(a){return new JW.ObservableSet.Observer(this,a)},_add:function(a){if(this.set.json[a._iid]){return false}this.set.add(a);this.addEvent.trigger(new JW.ObservableSet.ItemEventParams(this,a));return true},_addAll:function(b){var d=false;for(var c=0,a=b.length;c<a;++c){d=this._add(b[c])||d}return d},_remove:function(a){if(!this.set.json[a._iid]){return false}this.set.remove(a);this.removeEvent.trigger(new JW.ObservableSet.ItemEventParams(this,a));return true},_removeAll:function(b){var d=false;for(var c=0,a=b.length;c<a;++c){d=this._remove(b[c])||d}return d},_clear:function(){if(this.set.size===0){return false}var b=JW.Set.clone(this.set.json);for(var a in b){this._remove(b[a])}return true},_triggerChange:function(){if(this.bulkCount!==0){this.bulkDirty=true;return}this.changeEvent.trigger(new JW.ObservableSet.EventParams(this));if(this.bulkSize!==this.set.size){this.sizeChangeEvent.trigger(new JW.ObservableSet.SizeChangeEventParams(this,this.bulkSize,this.set.size));this.bulkSize=this.set.size}}});JW.ObservableSet.prototype.getLength=JW.ObservableSet.prototype.getSize;JW.ObservableSet.prototype.pushItem=JW.ObservableSet.prototype.add;JW.applyIf(JW.ObservableSet.prototype,JW.Alg.BuildMethods);JW.ObservableSet.EventParams=function(a){JW.ObservableSet.EventParams._super.call(this,a)};JW.extend(JW.ObservableSet.EventParams,JW.EventParams,{});JW.ObservableSet.ItemEventParams=function(a,b){JW.ObservableSet.ItemEventParams._super.call(this,a);this.item=b};JW.extend(JW.ObservableSet.ItemEventParams,JW.ObservableSet.EventParams,{});JW.ObservableSet.SizeChangeEventParams=function(b,c,a){JW.ObservableSet.SizeChangeEventParams._super.call(this,b);this.oldSize=c;this.newSize=a};JW.extend(JW.ObservableSet.SizeChangeEventParams,JW.ObservableSet.EventParams,{});JW.ObservableSet.Indexer=function(b,a){JW.ObservableSet.Indexer._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._changeEventAttachment=this.source.changeEvent.bind(this._onChange,this)};JW.extend(JW.ObservableSet.Indexer,JW.AbstractSet.Indexer,{destroy:function(){this._changeEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this._add(a.item)},_onRemove:function(a){this._remove(a.item)},_onChange:function(){this._change()}});JW.ObservableSet.Mapper=function(b,a){JW.ObservableSet.Mapper._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this);this._changeEventAttachment=this.source.changeEvent.bind(this._onChange,this)};JW.extend(JW.ObservableSet.Mapper,JW.AbstractSet.Mapper,{destroy:function(){this._changeEventAttachment.destroy();this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this._add(a.item)},_onRemove:function(a){this._remove(a.item)},_onChange:function(a){this._change()}});JW.ObservableSet.Observer=function(b,a){JW.ObservableSet.Observer._super.call(this,b,a);this._addEventAttachment=this.source.addEvent.bind(this._onAdd,this);this._removeEventAttachment=this.source.removeEvent.bind(this._onRemove,this)
};JW.extend(JW.ObservableSet.Observer,JW.AbstractSet.Observer,{destroy:function(){this._removeEventAttachment.destroy();this._addEventAttachment.destroy();this._super()},_onAdd:function(a){this._addItem(a.item)},_onRemove:function(a){this._removeItem(a.item)}});JW.makeFactory=function(a,b){b=b||"id";JW.apply(a,{items:{},registerItem:function(c){a.items[c[b]]=c},getItem:function(c){return(c instanceof a)?c:a.items[c]},getId:function(c){return(c instanceof a)?c[b]:c}});return a};JW.Proxy=function(a){JW.Proxy._super.call(this);this.value=a};JW.extend(JW.Proxy,JW.Class,{});JW.setInterval=function(callback,ms){if(!ms){return setInterval(callback,ms)}if(typeof callback=="string"){callback=function(){eval(callback)}}var lastTime=Date.getTime();function onInterval(){var curTime=Date.getTime();if(curTime-lastTime>10*ms){lastTime=curTime-ms}var b=true;while(b||(lastTime<curTime)){b=false;lastTime+=ms;callback()}}return setInterval(onInterval,ms)};JW.String={htmlEncode:function(a){return String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(a){return String(a).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},removeScripts:function(c){c=String(c);var a=[];var b=0;while(true){var d=c.indexOf("<script",b);if(d===-1){break}a.push(c.substr(b,d-b));b=c.indexOf("<\/script>",d)+9;if(b===-1){return a.join("")}}a.push(c.substr(b));return a.join("")},ellipsis:function(c,b,a){c=String(c);if(c.length<=b){return c}a=a||"...";return c.substr(0,b-a.length)+a},prepend:function(e,d,c){e=String(e);var a=[];d-=e.length;for(var b=0;b<d;++b){a.push(c)}a.push(e);return a.join("")},capitalize:function(a){a=String(a);return a.charAt(0).toUpperCase()+a.substr(1)},camel:function(a){return String(a).replace(/-([a-z])/ig,JW.String._fcamel)},hyphen:function(a){return String(a).replace(/([A-Z])/g,JW.String._fhyphen)},trim:function(a){return String(a).replace(/^\s*/,"").replace(/\s*$/,"")},_fcamel:function(d,c){return c.toUpperCase()},_fhyphen:function(d,c){return"-"+c.toLowerCase()}};JW.Timer=function(b,c,a){JW.Timer._super.call(this);this.tickEvent=new JW.Event();this.delay=b||0;this.repeat=c||false;this.sensitive=a||false;this._handle=0;this._onTimeout=JW.inScope(this._onTimeout,this)};JW.extend(JW.Timer,JW.Class,{destroy:function(){this.stop();this.tickEvent.destroy();this._super()},start:function(){if(this.isStarted()){return}var a=this._getRunner();this._handle=a(this._onTimeout,this.delay)},stop:function(){if(!this.isStarted()){return}var a=this._getStopper();a(this._handle);this._handle=0},restart:function(){this.stop();this.start()},isStarted:function(){return this._handle!==0},_getRunner:function(){return !this.repeat?setTimeout:this.sensitive?JW.setInterval:setInterval},_getStopper:function(){return this.repeat?clearInterval:clearTimeout},_onTimeout:function(){if(!this.repeat){this._handle=0}this.tickEvent.trigger(new JW.Timer.EventParams(this))}});JW.Timer.EventParams=JW.EventParams.extend();